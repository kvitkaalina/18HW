#!/bin/bash

# Запрос адреса для пинга
read -p "Введите адрес для пинга (например, google.com): " address

# Инициализация счетчика неудачных попыток
fail_count=0

# Бесконечный цикл для пинга
while true; do
  # Выполняем один пинг и извлекаем среднее время отклика
  ping_result=$(ping -c 1 -W 1 "$address" 2>/dev/null | grep "time=" | awk -F'time=' '{print $2}' | awk '{print $1}')

  if [[ -z "$ping_result" ]]; then
    # Если пинг не удался, увеличиваем счетчик неудачных попыток
    fail_count=$((fail_count + 1))
    echo "Попытка $fail_count: Не удалось получить ответ от $address"
  else
    # Сбрасываем счетчик неудачных попыток, если пинг успешный
    fail_count=0

    # Проверяем, превышает ли время отклика 100 мс
    if (( $(echo "$ping_result > 100" | bc -l) )); then
      echo "Время отклика $ping_result мс превышает 100 мс"
    else
      echo "Время отклика $ping_result мс в пределах нормы"
    fi
  fi

  # Если три последовательных попытки пинга неудачны, выводим сообщение и выходим
  if [[ "$fail_count" -ge 3 ]]; then
    echo "Слишком много неудачных попыток пинга подряд. Завершаем работу."
    exit 1
  fi

  # Ждем 1 секунду перед следующим пингом
  sleep 1
done
